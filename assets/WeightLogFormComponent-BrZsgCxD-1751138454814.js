import{j as t,d as _,k as C}from"./index-CocNiPHx-1751138454814.js";import{r as p}from"./stripe-vendor-yG7JauXe-1751138454814.js";import{C as H}from"./chart-vendor-QA3Wtuko-1751138454814.js";import{I,L as f,l as b,O as q,C as N,t as Y}from"./date-vendor-B5WjnTJ1-1751138454814.js";import{M as $,T as K}from"./MetricsCard-xr3HQmsO-1751138454814.js";const X=({userProfile:a,actualWeightLog:n,currentTheme:v})=>{const m=p.useRef(null),u=p.useRef(null),W=p.useMemo(()=>!n.length||!a?[]:n.map(c=>({date:I(new Date(c.date),"yyyy-MM-dd"),value:c.weight,target:a.targetWeight||void 0,label:I(new Date(c.date),"MMM dd")})),[n,a]),S=p.useMemo(()=>{var k,r;if(!n.length||!a)return[];const c=((k=n[n.length-1])==null?void 0:k.weight)||0,o=a.startWeight||a.weight||c,y=a.targetWeight||c,j=n.length>1?(r=n[n.length-2])==null?void 0:r.weight:o,h=o-c,w=c-y,D=Math.abs(o-y)>0?Math.min(Math.abs(h)/Math.abs(o-y)*100,100):0;return[{label:"Current Weight",value:c,previousValue:j,format:"decimal",unit:"lbs",color:"bg-teal-500"},{label:"Weight Lost",value:Math.max(0,h),format:"decimal",unit:"lbs",color:"bg-green-500"},{label:"Progress",value:D,target:100,format:"percentage",color:"bg-blue-500"},{label:"To Goal",value:Math.abs(w),format:"decimal",unit:"lbs",color:"bg-orange-500"}]},[n,a]);return!a||a.targetWeight===null?t.jsxs("div",{className:"bg-bg-card p-6 sm:p-8 rounded-xl shadow-xl min-h-[350px] sm:min-h-[450px]",children:[t.jsxs("h3",{className:"text-xl font-semibold text-text-default mb-4 pb-3 border-b border-border-default",children:[t.jsx("i",{className:"fas fa-chart-line mr-2.5 text-teal-600 dark:text-teal-400"}),"Weight Progress"]}),t.jsx(_,{icon:"fas fa-weight",iconColor:"text-teal-500 dark:text-teal-400",title:"Set Your Target Weight",description:"Define your weight goal to see your progress visualized on this chart.",actionLabel:"Go to Settings",onAction:()=>window.dispatchEvent(new CustomEvent("navigate-to-settings")),tips:["Track your weight regularly for best results","See your projected path to your goal","Monitor your progress over time"]})]}):(p.useEffect(()=>{var O;if(!m.current)return;u.current&&u.current.destroy();const c=m.current.getContext("2d");if(!c)return;const o=v==="dark",y=o?"rgb(203, 213, 225)":"rgb(71, 85, 105)",j=o?"rgba(71, 85, 105, 0.5)":"rgba(203, 213, 225, 0.5)",h=o?"rgb(241, 245, 249)":"rgb(51, 65, 85)",w=h,D=[...n].sort((e,l)=>f(e.date).getTime()-f(l.date).getTime()),k=D.map(e=>({x:b(f(e.date)).getTime(),y:e.weight}));let r=[];const s=a.targetWeight;let M,i=(O=a.startWeight)!=null?O:null;if(!i&&D.length>0?i=D[0].weight:!i&&a.weight&&(i=a.weight),D.length>0?M=b(f(D[0].date)):a.profileCreationDate?M=b(f(a.profileCreationDate)):M=b(new Date),s!==null&&i!==null){let e,l;if(a.targetDate){const d=b(f(a.targetDate)),E=q(d,M);E>0?(l=E/7,e=(s-i)/l):(l=Math.abs(s-i)/C,e=i>s?-C:C,i===s&&(e=0))}else l=Math.abs(s-i)/C,e=i>s?-C:C,i===s&&(e=0);(Math.abs(e)===1/0||isNaN(e))&&(e=0);const B=a.targetDate?Math.max(l+1,4):Math.max(l+4,8);for(let d=0;d<=Math.ceil(B);d++){const E=N(M,d);let x=i+d*e;if(e>0&&x>s&&(x=s),e<0&&x<s&&(x=s),r.push({x:E.getTime(),y:parseFloat(x.toFixed(1))}),a.targetDate&&x===s&&d>=l&&l>0||d>l+12&&!a.targetDate)break}if(a.targetDate&&r.length>0){const d=b(f(a.targetDate)).getTime();r[r.length-1].x<d?r.push({x:d,y:s}):(r=r.filter(x=>x.x<=d),(r.length===0||r[r.length-1].x<d)&&r.push({x:d,y:s})),r=r.sort((x,G)=>x.x-G.x)}else if(r.length===0&&i!==null&&s!==null&&(r.push({x:M.getTime(),y:i}),i!==s)){const d=a.targetDate?b(f(a.targetDate)):N(M,Math.ceil(l)||1);r.push({x:d.getTime(),y:s})}}let g=b(new Date).getTime(),R=g,A=g,T=!1;if(k.length>0){const e=k.map(l=>l.x);g=Math.min(g,...e),R=Math.max(...e),T=!0}if(r.length>0){const e=r.map(l=>l.x);g=T?Math.min(g,...e):Math.min(g,...e),A=Math.max(...e),T=!0}if(!T){const e=b(new Date).getTime();g=e,R=N(new Date(e),4).getTime(),A=R,s!==null&&(i!==null&&r.push({x:e,y:i}),r.push({x:N(new Date(e),4).getTime(),y:s}))}let F=Math.max(g,R,A,N(b(new Date),1).getTime());Y(new Date(F),new Date(g))<4&&(F=N(new Date(g),4).getTime());const z={type:"line",data:{datasets:[{label:"Actual Weight",data:k,borderColor:o?"rgb(20, 184, 166)":"rgb(13, 148, 136)",backgroundColor:o?"rgba(20, 184, 166, 0.2)":"rgba(13, 148, 136, 0.1)",tension:.2,fill:!1,pointRadius:5,pointHoverRadius:7,pointBackgroundColor:o?"rgb(20, 184, 166)":"rgb(13, 148, 136)"},{label:"Projected Path",data:r,borderColor:o?"rgb(251, 146, 60)":"rgb(249, 115, 22)",borderDash:[6,3],tension:.2,fill:!1,pointRadius:3,pointHoverRadius:5,pointBackgroundColor:o?"rgb(251, 146, 60)":"rgb(249, 115, 22)"},{label:"Target Weight",data:s!==null&&T?[{x:g,y:s},{x:F,y:s}]:[],borderColor:o?"rgb(96, 165, 250)":"rgb(59, 130, 246)",borderDash:[10,5],borderWidth:2.5,pointRadius:0,fill:!1}]},options:{responsive:!0,maintainAspectRatio:!1,scales:{x:{type:"time",time:{unit:"day",tooltipFormat:"MMM d, yyyy",displayFormats:{day:"MMM d"}},title:{display:!0,text:"Date",font:{size:14,family:"Inter, sans-serif"},color:h},min:g,max:F,grid:{color:j},ticks:{color:y,maxTicksLimit:7,padding:10,autoSkip:!0}},y:{title:{display:!0,text:"Weight (lbs)",font:{size:14,family:"Inter, sans-serif"},color:h},beginAtZero:!1,grid:{color:j},ticks:{color:y}}},plugins:{legend:{position:"bottom",labels:{font:{family:"Inter, sans-serif"},color:w,usePointStyle:!0,boxWidth:8}},tooltip:{mode:"index",intersect:!1,backgroundColor:o?"rgba(30, 41, 59, 0.9)":"rgba(15, 23, 42, 0.85)",titleFont:{size:14,family:"Inter, sans-serif",weight:"bold"},bodyFont:{family:"Inter, sans-serif"},titleColor:o?"#f1f5f9":"#ffffff",bodyColor:o?"#e2e8f0":"#f1f5f9",padding:10,cornerRadius:6,callbacks:{title:function(e){if(e.length>0){const l=new Date(e[0].parsed.x);return I(l,"EEEE, MMM d, yyyy")}return""},label:function(e){let l=e.dataset.label||"";return l&&(l+=": "),e.parsed.y!==null&&(l+=e.parsed.y.toFixed(1)+" lbs"),l}}}}}};return u.current=new H(c,z),()=>{u.current&&(u.current.destroy(),u.current=null)}},[a,n,v]),n.length>0&&W.length>0?t.jsxs("div",{className:"space-y-6",children:[t.jsx($,{title:"Weight Progress Overview",metrics:S,icon:"fas fa-weight",variant:"default",showTrends:!0,showProgress:!0,animated:!0}),t.jsx(K,{data:W,title:"Weight Trend",subtitle:"Track your progress over time",showTarget:!0,showDots:!0,showArea:!0,color:"#14b8a6",targetColor:"#ef4444",timeframe:"month",unit:" lbs",height:300}),t.jsxs("div",{className:"bg-bg-card p-6 sm:p-8 rounded-xl shadow-xl min-h-[350px] sm:min-h-[450px]",children:[t.jsxs("h3",{className:"text-xl font-semibold text-text-default mb-4 pb-3 border-b border-border-default",children:[t.jsx("i",{className:"fas fa-chart-line mr-2.5 text-teal-600 dark:text-teal-400"}),"Detailed Weight Chart"]}),t.jsx("div",{className:"relative h-[280px] sm:h-[380px]",children:t.jsx("canvas",{ref:m,"aria-label":"Weight progress chart",role:"img"})})]})]}):t.jsxs("div",{className:"bg-bg-card p-6 sm:p-8 rounded-xl shadow-xl min-h-[350px] sm:min-h-[450px]",children:[t.jsxs("h3",{className:"text-xl font-semibold text-text-default mb-4 pb-3 border-b border-border-default",children:[t.jsx("i",{className:"fas fa-chart-line mr-2.5 text-teal-600 dark:text-teal-400"}),"Weight Progress"]}),t.jsx("div",{className:"relative h-[280px] sm:h-[380px]",children:t.jsx("canvas",{ref:m,"aria-label":"Weight progress chart",role:"img"})})]}))},L=({onAddWeightEntry:a,latestWeight:n})=>{const[v]=p.useState(()=>I(new Date,"yyyy-MM-dd")),[m,u]=p.useState(v),[W,S]=p.useState(""),[c,o]=p.useState(null),y=h=>{h.preventDefault(),o(null);const w=parseFloat(W);if(isNaN(w)||w<=0||w>2e3){o("Please enter a valid weight (e.g., between 10 and 2000 lbs).");return}if(!m){o("Please select a date.");return}try{f(m+"T00:00:00")}catch(D){o("Invalid date format selected.");return}a({date:m,weight:w}),S("")},j="block w-full px-4 py-2.5 border border-border-default rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-teal-500 focus:border-teal-500 sm:text-sm placeholder-slate-400 bg-bg-card text-text-default dark:placeholder-slate-500";return t.jsxs("div",{className:"bg-bg-card p-6 rounded-xl shadow-xl",children:[t.jsxs("h3",{className:"text-lg font-semibold text-text-default mb-4 pb-3 border-b border-border-default",children:[t.jsx("i",{className:"fas fa-weight-scale mr-2.5 text-teal-600 dark:text-teal-400"}),"Log Your Weight",t.jsx("span",{className:"text-sm font-normal text-text-alt ml-2",children:"(Past dates allowed)"})]}),t.jsxs("form",{onSubmit:y,className:"space-y-4",children:[t.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[t.jsxs("div",{children:[t.jsxs("label",{htmlFor:"logWeightDate",className:"block text-sm font-medium text-text-alt mb-1",children:["Date ",t.jsx("span",{className:"text-xs text-text-alt font-normal",children:"(select any past date)"})]}),t.jsx("input",{type:"date",id:"logWeightDate",value:m,onChange:h=>u(h.target.value),className:`${j} dark:[color-scheme:dark]`,max:v,required:!0}),m!==v&&t.jsx("div",{className:"mt-1",children:t.jsx("button",{type:"button",onClick:()=>u(v),className:"text-xs text-teal-600 hover:text-teal-700 dark:text-teal-400 dark:hover:text-teal-300 underline",children:"â† Back to today"})})]}),t.jsxs("div",{children:[t.jsx("label",{htmlFor:"logWeightLbs",className:"block text-sm font-medium text-text-alt",children:"Weight (lbs)"}),t.jsx("input",{type:"number",id:"logWeightLbs",value:W,onChange:h=>S(h.target.value),className:j,placeholder:n?`e.g., ${n.toFixed(1)}`:"e.g., 150.5",step:"0.1",min:"10",max:"2000",required:!0})]})]}),c&&t.jsx("p",{className:"text-red-600 dark:text-red-400 text-sm mt-1",role:"alert",children:c}),t.jsxs("button",{type:"submit",className:"w-full bg-gradient-to-r from-teal-500 to-cyan-500 hover:from-teal-600 hover:to-cyan-600 text-white font-semibold py-2.5 px-4 rounded-lg shadow-md hover:shadow-lg focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-teal-500 transition-all duration-150 disabled:opacity-70 disabled:cursor-not-allowed",children:[t.jsx("i",{className:"fas fa-save mr-2"}),"Save Weigh-in"]})]})]})};export{X as W,L as a};
