import{j as t,d as B,k as C}from"./index-sOLfNbJt-1751134427739.js";import{r as D}from"./stripe-vendor-18sUXpVQ-1751134427739.js";import{C as H}from"./chart-vendor-BjvvCLW4-1751134427739.js";import{I,L as u,l as x,O as q,C as W,t as Y}from"./date-vendor-B5WjnTJ1-1751134427739.js";import{M as $,T as K}from"./MetricsCard-DyxJ09rB-1751134427739.js";const X=({userProfile:a,actualWeightLog:n,currentTheme:k})=>{const b=D.useRef(null),f=D.useRef(null),T=D.useMemo(()=>!n.length||!a?[]:n.map(c=>({date:I(new Date(c.date),"yyyy-MM-dd"),value:c.weight,target:a.targetWeight||void 0,label:I(new Date(c.date),"MMM dd")})),[n,a]),S=D.useMemo(()=>{var j,r;if(!n.length||!a)return[];const c=((j=n[n.length-1])==null?void 0:j.weight)||0,i=a.startWeight||a.weight||c,p=a.targetWeight||c,v=n.length>1?(r=n[n.length-2])==null?void 0:r.weight:i,h=i-c,y=c-p,w=Math.abs(i-p)>0?Math.min(Math.abs(h)/Math.abs(i-p)*100,100):0;return[{label:"Current Weight",value:c,previousValue:v,format:"decimal",unit:"lbs",color:"bg-teal-500"},{label:"Weight Lost",value:Math.max(0,h),format:"decimal",unit:"lbs",color:"bg-green-500"},{label:"Progress",value:w,target:100,format:"percentage",color:"bg-blue-500"},{label:"To Goal",value:Math.abs(y),format:"decimal",unit:"lbs",color:"bg-orange-500"}]},[n,a]);return!a||a.targetWeight===null?t.jsxs("div",{className:"bg-bg-card p-6 sm:p-8 rounded-xl shadow-xl min-h-[350px] sm:min-h-[450px]",children:[t.jsxs("h3",{className:"text-xl font-semibold text-text-default mb-4 pb-3 border-b border-border-default",children:[t.jsx("i",{className:"fas fa-chart-line mr-2.5 text-teal-600 dark:text-teal-400"}),"Weight Progress"]}),t.jsx(B,{icon:"fas fa-weight",iconColor:"text-teal-500 dark:text-teal-400",title:"Set Your Target Weight",description:"Define your weight goal to see your progress visualized on this chart.",actionLabel:"Go to Settings",onAction:()=>window.dispatchEvent(new CustomEvent("navigate-to-settings")),tips:["Track your weight regularly for best results","See your projected path to your goal","Monitor your progress over time"]})]}):(D.useEffect(()=>{var O;if(!b.current)return;f.current&&f.current.destroy();const c=b.current.getContext("2d");if(!c)return;const i=k==="dark",p=i?"rgb(203, 213, 225)":"rgb(71, 85, 105)",v=i?"rgba(71, 85, 105, 0.5)":"rgba(203, 213, 225, 0.5)",h=i?"rgb(241, 245, 249)":"rgb(51, 65, 85)",y=h,w=[...n].sort((e,l)=>u(e.date).getTime()-u(l.date).getTime()),j=w.map(e=>({x:x(u(e.date)).getTime(),y:e.weight}));let r=[];const s=a.targetWeight;let M,o=(O=a.startWeight)!=null?O:null;if(!o&&w.length>0?o=w[0].weight:!o&&a.weight&&(o=a.weight),w.length>0?M=x(u(w[0].date)):a.profileCreationDate?M=x(u(a.profileCreationDate)):M=x(new Date),s!==null&&o!==null){let e,l;if(a.targetDate){const d=x(u(a.targetDate)),E=q(d,M);E>0?(l=E/7,e=(s-o)/l):(l=Math.abs(s-o)/C,e=o>s?-C:C,o===s&&(e=0))}else l=Math.abs(s-o)/C,e=o>s?-C:C,o===s&&(e=0);(Math.abs(e)===1/0||isNaN(e))&&(e=0);const G=a.targetDate?Math.max(l+1,4):Math.max(l+4,8);for(let d=0;d<=Math.ceil(G);d++){const E=W(M,d);let m=o+d*e;if(e>0&&m>s&&(m=s),e<0&&m<s&&(m=s),r.push({x:E.getTime(),y:parseFloat(m.toFixed(1))}),a.targetDate&&m===s&&d>=l&&l>0||d>l+12&&!a.targetDate)break}if(a.targetDate&&r.length>0){const d=x(u(a.targetDate)).getTime();r[r.length-1].x<d?r.push({x:d,y:s}):(r=r.filter(m=>m.x<=d),(r.length===0||r[r.length-1].x<d)&&r.push({x:d,y:s})),r=r.sort((m,_)=>m.x-_.x)}else if(r.length===0&&o!==null&&s!==null&&(r.push({x:M.getTime(),y:o}),o!==s)){const d=a.targetDate?x(u(a.targetDate)):W(M,Math.ceil(l)||1);r.push({x:d.getTime(),y:s})}}let g=x(new Date).getTime(),R=g,A=g,N=!1;if(j.length>0){const e=j.map(l=>l.x);g=Math.min(g,...e),R=Math.max(...e),N=!0}if(r.length>0){const e=r.map(l=>l.x);g=N?Math.min(g,...e):Math.min(g,...e),A=Math.max(...e),N=!0}if(!N){const e=x(new Date).getTime();g=e,R=W(new Date(e),4).getTime(),A=R,s!==null&&(o!==null&&r.push({x:e,y:o}),r.push({x:W(new Date(e),4).getTime(),y:s}))}let F=Math.max(g,R,A,W(x(new Date),1).getTime());Y(new Date(F),new Date(g))<4&&(F=W(new Date(g),4).getTime());const z={type:"line",data:{datasets:[{label:"Actual Weight",data:j,borderColor:i?"rgb(20, 184, 166)":"rgb(13, 148, 136)",backgroundColor:i?"rgba(20, 184, 166, 0.2)":"rgba(13, 148, 136, 0.1)",tension:.2,fill:!1,pointRadius:5,pointHoverRadius:7,pointBackgroundColor:i?"rgb(20, 184, 166)":"rgb(13, 148, 136)"},{label:"Projected Path",data:r,borderColor:i?"rgb(251, 146, 60)":"rgb(249, 115, 22)",borderDash:[6,3],tension:.2,fill:!1,pointRadius:3,pointHoverRadius:5,pointBackgroundColor:i?"rgb(251, 146, 60)":"rgb(249, 115, 22)"},{label:"Target Weight",data:s!==null&&N?[{x:g,y:s},{x:F,y:s}]:[],borderColor:i?"rgb(96, 165, 250)":"rgb(59, 130, 246)",borderDash:[10,5],borderWidth:2.5,pointRadius:0,fill:!1}]},options:{responsive:!0,maintainAspectRatio:!1,scales:{x:{type:"time",time:{unit:"day",tooltipFormat:"MMM d, yyyy",displayFormats:{day:"MMM d"}},title:{display:!0,text:"Date",font:{size:14,family:"Inter, sans-serif"},color:h},min:g,max:F,grid:{color:v},ticks:{color:p,maxTicksLimit:7,padding:10,autoSkip:!0}},y:{title:{display:!0,text:"Weight (lbs)",font:{size:14,family:"Inter, sans-serif"},color:h},beginAtZero:!1,grid:{color:v},ticks:{color:p}}},plugins:{legend:{position:"bottom",labels:{font:{family:"Inter, sans-serif"},color:y,usePointStyle:!0,boxWidth:8}},tooltip:{mode:"index",intersect:!1,backgroundColor:i?"rgba(30, 41, 59, 0.9)":"rgba(15, 23, 42, 0.85)",titleFont:{size:14,family:"Inter, sans-serif",weight:"bold"},bodyFont:{family:"Inter, sans-serif"},titleColor:i?"#f1f5f9":"#ffffff",bodyColor:i?"#e2e8f0":"#f1f5f9",padding:10,cornerRadius:6,callbacks:{title:function(e){if(e.length>0){const l=new Date(e[0].parsed.x);return I(l,"EEEE, MMM d, yyyy")}return""},label:function(e){let l=e.dataset.label||"";return l&&(l+=": "),e.parsed.y!==null&&(l+=e.parsed.y.toFixed(1)+" lbs"),l}}}}}};return f.current=new H(c,z),()=>{f.current&&(f.current.destroy(),f.current=null)}},[a,n,k]),n.length>0&&T.length>0?t.jsxs("div",{className:"space-y-6",children:[t.jsx($,{title:"Weight Progress Overview",metrics:S,icon:"fas fa-weight",variant:"default",showTrends:!0,showProgress:!0,animated:!0}),t.jsx(K,{data:T,title:"Weight Trend",subtitle:"Track your progress over time",showTarget:!0,showDots:!0,showArea:!0,color:"#14b8a6",targetColor:"#ef4444",timeframe:"month",unit:" lbs",height:300}),t.jsxs("div",{className:"bg-bg-card p-6 sm:p-8 rounded-xl shadow-xl min-h-[350px] sm:min-h-[450px]",children:[t.jsxs("h3",{className:"text-xl font-semibold text-text-default mb-4 pb-3 border-b border-border-default",children:[t.jsx("i",{className:"fas fa-chart-line mr-2.5 text-teal-600 dark:text-teal-400"}),"Detailed Weight Chart"]}),t.jsx("div",{className:"relative h-[280px] sm:h-[380px]",children:t.jsx("canvas",{ref:b,"aria-label":"Weight progress chart",role:"img"})})]})]}):t.jsxs("div",{className:"bg-bg-card p-6 sm:p-8 rounded-xl shadow-xl min-h-[350px] sm:min-h-[450px]",children:[t.jsxs("h3",{className:"text-xl font-semibold text-text-default mb-4 pb-3 border-b border-border-default",children:[t.jsx("i",{className:"fas fa-chart-line mr-2.5 text-teal-600 dark:text-teal-400"}),"Weight Progress"]}),t.jsx("div",{className:"relative h-[280px] sm:h-[380px]",children:t.jsx("canvas",{ref:b,"aria-label":"Weight progress chart",role:"img"})})]}))},L=({onAddWeightEntry:a,latestWeight:n})=>{const k=I(new Date,"yyyy-MM-dd"),[b,f]=D.useState(k),[T,S]=D.useState(""),[c,i]=D.useState(null),p=h=>{h.preventDefault(),i(null);const y=parseFloat(T);if(isNaN(y)||y<=0||y>2e3){i("Please enter a valid weight (e.g., between 10 and 2000 lbs).");return}if(!b){i("Please select a date.");return}try{u(b+"T00:00:00")}catch(w){i("Invalid date format selected.");return}a({date:b,weight:y}),S("")},v="block w-full px-4 py-2.5 border border-border-default rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-teal-500 focus:border-teal-500 sm:text-sm placeholder-slate-400 bg-bg-card text-text-default dark:placeholder-slate-500";return t.jsxs("div",{className:"bg-bg-card p-6 rounded-xl shadow-xl",children:[t.jsxs("h3",{className:"text-lg font-semibold text-text-default mb-4 pb-3 border-b border-border-default",children:[t.jsx("i",{className:"fas fa-weight-scale mr-2.5 text-teal-600 dark:text-teal-400"}),"Log Your Weight"]}),t.jsxs("form",{onSubmit:p,className:"space-y-4",children:[t.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[t.jsxs("div",{children:[t.jsx("label",{htmlFor:"logWeightDate",className:"block text-sm font-medium text-text-alt",children:"Date"}),t.jsx("input",{type:"date",id:"logWeightDate",value:b,onChange:h=>f(h.target.value),className:`${v} dark:[color-scheme:dark]`,max:k,required:!0})]}),t.jsxs("div",{children:[t.jsx("label",{htmlFor:"logWeightLbs",className:"block text-sm font-medium text-text-alt",children:"Weight (lbs)"}),t.jsx("input",{type:"number",id:"logWeightLbs",value:T,onChange:h=>S(h.target.value),className:v,placeholder:n?`e.g., ${n.toFixed(1)}`:"e.g., 150.5",step:"0.1",min:"10",max:"2000",required:!0})]})]}),c&&t.jsx("p",{className:"text-red-600 dark:text-red-400 text-sm mt-1",role:"alert",children:c}),t.jsxs("button",{type:"submit",className:"w-full bg-gradient-to-r from-teal-500 to-cyan-500 hover:from-teal-600 hover:to-cyan-600 text-white font-semibold py-2.5 px-4 rounded-lg shadow-md hover:shadow-lg focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-teal-500 transition-all duration-150 disabled:opacity-70 disabled:cursor-not-allowed",children:[t.jsx("i",{className:"fas fa-save mr-2"}),"Save Weigh-in"]})]})]})};export{X as W,L as a};
