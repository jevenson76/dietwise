import{A as v,g as A,t as w,j as e,a as C,L as E,E as L,c as _,b as I}from"./index-sOLfNbJt-1751134427739.js";import{r as d}from"./stripe-vendor-18sUXpVQ-1751134427739.js";import"./react-vendor-DV_4xMyD-1751134427739.js";import"./pdf-vendor-BD44sDxa-1751134427739.js";import"./ai-vendor-D-53sdHu-1751134427739.js";import"./scanner-vendor-UkOZGUfT-1751134427739.js";import"./date-vendor-B5WjnTJ1-1751134427739.js";import"./chart-vendor-BjvvCLW4-1751134427739.js";const z=15*60*1e3,k=({mealName:s,meal:r,accentColor:l})=>e.jsxs("div",{className:"mb-3",children:[e.jsx("h5",{className:`font-semibold ${l}`,children:s}),e.jsxs("p",{className:"text-sm text-text-default",children:[e.jsx("span",{className:"font-medium",children:r.name}),": ",r.description]}),r.calories&&e.jsxs("p",{className:"text-xs text-text-alt",children:["~",r.calories," kcal"]})]}),R=({dayPlan:s})=>e.jsxs("div",{className:"bg-slate-50 dark:bg-slate-700/50 p-4 rounded-lg shadow-md mb-4 border border-border-default",children:[e.jsxs("h4",{className:"text-lg font-semibold text-teal-700 dark:text-teal-400 mb-3 border-b border-slate-300 dark:border-slate-600 pb-2",children:["Day ",s.day," ",s.dailyCalories?e.jsxs("span",{className:"text-sm font-normal text-text-alt",children:["(~",s.dailyCalories," kcal)"]}):""]}),e.jsx(k,{mealName:"Breakfast",meal:s.meals.breakfast,accentColor:"text-orange-600 dark:text-orange-400"}),e.jsx(k,{mealName:"Lunch",meal:s.meals.lunch,accentColor:"text-lime-600 dark:text-lime-400"}),e.jsx(k,{mealName:"Dinner",meal:s.meals.dinner,accentColor:"text-sky-600 dark:text-sky-400"}),s.meals.snacks&&s.meals.snacks.length>0&&e.jsxs("div",{children:[e.jsx("h5",{className:"font-semibold text-purple-600 dark:text-purple-400",children:"Snacks"}),s.meals.snacks.map((r,l)=>e.jsxs("p",{className:"text-sm text-text-alt ml-2 mb-1",children:[e.jsx("span",{className:"font-medium text-text-default",children:r.name}),": ",r.description," ",r.calories?e.jsxs("span",{className:"text-xs text-text-alt",children:["(~",r.calories," kcal)"]}):""]},l))]})]}),O=({calorieTarget:s,isProfileComplete:r,apiKeyStatus:l,apiKeyMissing:c,onPlanGenerated:p})=>{const[h,f]=d.useState(null),[u,b]=d.useState(!1),[y,n]=d.useState(null),[m,S]=d.useState(""),[N,g]=d.useState([]),o=d.useRef(null),P=d.useCallback(async()=>{if(c){n(v);return}if(!s){n("Please complete your profile and set goals to generate a meal plan.");return}if(l==="missing"){n("API Key is not configured. This feature is unavailable.");return}b(!0),n(null),f(null),g([]);const t=`mealPlan-${s}-${m}`,x=Date.now();if(o.current&&o.current.key===t&&x-o.current.timestamp<z){f(o.current.data),g(o.current.sources||[]),b(!1),p(`Cached Plan for ${s} kcal`);return}try{const a=await A(s,m);let i=[];a.sources&&(i=a.sources.filter(j=>j.web!==void 0).map(j=>({web:j.web}))),g(i),a.planData?(f(a.planData),o.current={key:t,data:a.planData,sources:i,timestamp:x},w("meal_plan_fetch_success",{calorieTarget:s,preferences:m}),p(`Plan for ${s} kcal`)):(n(a.error||"Failed to generate meal plan. Please try again."),w("meal_plan_fetch_error",{calorieTarget:s,preferences:m,error:a.error}),o.current=null)}catch(a){const i=a.message||"An unexpected error occurred while generating the plan.";n(i),o.current=null}finally{b(!1)}},[s,m,l,c,p]),D="mt-1 block w-full px-4 py-2.5 border border-border-default rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-teal-500 focus:border-teal-500 sm:text-sm placeholder-slate-400 bg-bg-card text-text-default dark:placeholder-slate-500";return!r||!s?e.jsxs("div",{className:"bg-bg-card p-6 sm:p-8 rounded-xl shadow-xl mt-6 sm:mt-8",children:[e.jsxs("h2",{className:"text-xl sm:text-2xl font-semibold text-text-default mb-4",children:[e.jsx("i",{className:"fas fa-calendar-alt mr-2.5 text-sky-500 dark:text-sky-400"}),"7-Day Meal Plan & Shopping List"]}),e.jsx("div",{className:"bg-sky-50 dark:bg-sky-900/30 border-l-4 border-sky-400 text-sky-700 dark:text-sky-300 p-4 rounded-md text-center",role:"status",children:e.jsxs("p",{className:"font-medium",children:[e.jsx("i",{className:"fas fa-info-circle mr-2"}),"Complete your profile and set a weight goal to generate a personalized 7-day meal plan and shopping list."]})})]}):e.jsxs("div",{className:"bg-bg-card p-6 sm:p-8 rounded-xl shadow-xl mt-6 sm:mt-8",children:[e.jsxs("h2",{className:"text-xl sm:text-2xl font-semibold text-text-default mb-2",children:[e.jsx("i",{className:"fas fa-calendar-alt mr-2.5 text-sky-500 dark:text-sky-400"}),"AI 7-Day Meal Plan & Shopping List"]}),e.jsxs("p",{className:"text-sm text-text-alt mb-6",children:["Enter any dietary preferences and let AI craft a plan for your ~",s," kcal target!"]}),c&&e.jsx(C,{type:"warning",message:e.jsxs(e.Fragment,{children:[e.jsx("strong",{children:"7-Day Planner Disabled:"}),e.jsx("br",{}),v]}),className:"mb-4"}),e.jsxs("div",{className:"mb-5",children:[e.jsx("label",{htmlFor:"planPreferences",className:"block text-sm font-medium text-text-alt",children:"Dietary Preferences or Foods to Include/Avoid (optional)"}),e.jsx("input",{type:"text",id:"planPreferences",value:m,onChange:t=>S(t.target.value),className:D,placeholder:"e.g., vegetarian, high protein, gluten-free, no mushrooms",maxLength:250,disabled:c}),e.jsx("p",{className:"text-xs text-text-alt mt-1.5",children:'Example: "vegetarian, loves spicy food, allergic to peanuts"'})]}),e.jsx("button",{onClick:P,disabled:u||!s||l!=="ok"||c,className:"w-full bg-gradient-to-r from-teal-500 to-cyan-500 hover:from-teal-600 hover:to-cyan-600 text-white font-semibold py-3 px-4 rounded-lg shadow-md hover:shadow-lg focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-teal-500 transition-all duration-150 disabled:opacity-70 disabled:cursor-not-allowed flex items-center justify-center","aria-busy":u,children:u?e.jsx(E,{size:"sm",color:"text-white",label:"Generating plan"}):e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"fas fa-magic fa-fw mr-2"}),"Generate Plan & List"]})}),l==="missing"&&!c&&e.jsx(C,{type:"warning",message:"Gemini API Key is missing or invalid. Plan generation is disabled.",className:"mt-4"}),y&&e.jsx("div",{className:"mt-4",children:e.jsx(L,{..._("meal-generation",y,{item:"meal plan"}),actions:[{label:"Try Again",action:generatePlan,icon:"fas fa-redo"},{label:"Adjust Preferences",action:()=>{var t;n(null),(t=document.getElementById("planPreferences"))==null||t.focus()},variant:"secondary"}],onClose:()=>n(null),compact:!0})}),u&&e.jsx("div",{className:"mt-8","aria-live":"polite",children:e.jsx(I,{message:"Creating Your Personalized Meal Plan",submessage:"Analyzing your preferences and nutritional needs...",estimatedTime:15,steps:{current:1,total:3,currentStep:"Generating meal ideas"},tips:["Calculating balanced nutrition for each meal","Ensuring variety across the week","Creating your shopping list with quantities","Considering your dietary preferences"],size:"md"})}),h&&!u&&e.jsxs("div",{className:"mt-8 pt-6 border-t border-border-default",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-x-6 lg:gap-x-8",children:[e.jsxs("div",{className:"mb-8 md:mb-0",children:[e.jsxs("h3",{className:"text-2xl font-semibold text-text-default mb-4 pb-2 border-b-2 border-teal-500",children:[e.jsx("i",{className:"fas fa-utensils mr-2 text-teal-600 dark:text-teal-400"}),"Your 7-Day Meal Plan"]}),e.jsx("p",{className:"text-sm text-text-alt mb-4",children:"Here's a sample meal plan. Adjust portion sizes based on your specific needs and the provided calorie estimates."}),e.jsx("div",{className:"space-y-5 max-h-[100vh] overflow-y-auto pr-3 -mr-1 custom-scrollbar",children:h.dailyPlans.map(t=>e.jsx(R,{dayPlan:t},t.day))})]}),e.jsxs("div",{children:[e.jsxs("h3",{className:"text-2xl font-semibold text-text-default mb-4 pb-2 border-b-2 border-orange-500",children:[e.jsx("i",{className:"fas fa-shopping-cart mr-2 text-orange-600 dark:text-orange-400"}),"Shopping List"]}),e.jsx("div",{className:"bg-orange-50 dark:bg-orange-800/30 p-4 rounded-lg shadow-md max-h-[100vh] overflow-y-auto pr-3 -mr-1 custom-scrollbar border border-orange-200 dark:border-orange-700",children:h.shoppingList.map((t,x)=>e.jsxs("div",{className:"mb-4 last:mb-0",children:[e.jsx("h4",{className:"text-lg font-semibold text-orange-700 dark:text-orange-300 mb-2 capitalize",children:t.category}),e.jsx("ul",{className:"list-disc list-inside space-y-1.5 pl-2",children:t.items.map((a,i)=>e.jsxs("li",{className:"text-sm text-text-default",children:[e.jsx("span",{className:"font-medium",children:a.name}),a.quantity&&e.jsxs("span",{className:"text-xs text-text-alt",children:[" - ",a.quantity]}),a.brandSuggestion&&e.jsxs("span",{className:"block text-xs text-text-alt italic ml-4",children:[" Suggestion: ",a.brandSuggestion]}),a.notes&&e.jsxs("span",{className:"block text-xs text-text-alt ml-4",children:[" Note: ",a.notes]})]},i))})]},x))})]})]}),N.length>0&&e.jsxs("div",{className:"mt-8 p-3 bg-sky-50 dark:bg-sky-800/50 border border-sky-200 dark:border-sky-700 rounded-lg w-full text-xs",children:[e.jsx("h4",{className:"text-sm font-semibold text-sky-700 dark:text-sky-300 mb-1.5",children:"Data Sources (from Google Search):"}),e.jsx("ul",{className:"list-disc list-inside space-y-1",children:N.map((t,x)=>t.web.uri?e.jsx("li",{children:e.jsx("a",{href:t.web.uri,target:"_blank",rel:"noopener noreferrer",className:"text-sky-600 dark:text-sky-400 hover:underline hover:text-sky-800 dark:hover:text-sky-300",children:t.web.title||t.web.uri})},x):null)})]})]})]})};export{O as default};
