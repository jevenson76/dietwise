
<!doctype html>
<html lang="en">

<head>
    <title>Code coverage report for dietwise/services/geminiService.ts</title>
    <meta charset="utf-8" />
    <link rel="stylesheet" href="../../prettify.css" />
    <link rel="stylesheet" href="../../base.css" />
    <link rel="shortcut icon" type="image/x-icon" href="../../favicon.png" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <style type='text/css'>
        .coverage-summary .sorter {
            background-image: url(../../sort-arrow-sprite.png);
        }
    </style>
</head>
    
<body>
<div class='wrapper'>
    <div class='pad1'>
        <h1><a href="../../index.html">All files</a> / <a href="index.html">dietwise/services</a> geminiService.ts</h1>
        <div class='clearfix'>
            
            <div class='fl pad1y space-right2'>
                <span class="strong">0% </span>
                <span class="quiet">Statements</span>
                <span class='fraction'>0/144</span>
            </div>
        
            
            <div class='fl pad1y space-right2'>
                <span class="strong">0% </span>
                <span class="quiet">Branches</span>
                <span class='fraction'>0/1</span>
            </div>
        
            
            <div class='fl pad1y space-right2'>
                <span class="strong">0% </span>
                <span class="quiet">Functions</span>
                <span class='fraction'>0/1</span>
            </div>
        
            
            <div class='fl pad1y space-right2'>
                <span class="strong">0% </span>
                <span class="quiet">Lines</span>
                <span class='fraction'>0/144</span>
            </div>
        
            
        </div>
        <p class="quiet">
            Press <em>n</em> or <em>j</em> to go to the next uncovered block, <em>b</em>, <em>p</em> or <em>k</em> for the previous block.
        </p>
        <template id="filterTemplate">
            <div class="quiet">
                Filter:
                <input type="search" id="fileSearch">
            </div>
        </template>
    </div>
    <div class='status-line low'></div>
    <pre><table class="coverage">
<tr><td class="line-count quiet"><a name='L1'></a><a href='#L1'>1</a>
<a name='L2'></a><a href='#L2'>2</a>
<a name='L3'></a><a href='#L3'>3</a>
<a name='L4'></a><a href='#L4'>4</a>
<a name='L5'></a><a href='#L5'>5</a>
<a name='L6'></a><a href='#L6'>6</a>
<a name='L7'></a><a href='#L7'>7</a>
<a name='L8'></a><a href='#L8'>8</a>
<a name='L9'></a><a href='#L9'>9</a>
<a name='L10'></a><a href='#L10'>10</a>
<a name='L11'></a><a href='#L11'>11</a>
<a name='L12'></a><a href='#L12'>12</a>
<a name='L13'></a><a href='#L13'>13</a>
<a name='L14'></a><a href='#L14'>14</a>
<a name='L15'></a><a href='#L15'>15</a>
<a name='L16'></a><a href='#L16'>16</a>
<a name='L17'></a><a href='#L17'>17</a>
<a name='L18'></a><a href='#L18'>18</a>
<a name='L19'></a><a href='#L19'>19</a>
<a name='L20'></a><a href='#L20'>20</a>
<a name='L21'></a><a href='#L21'>21</a>
<a name='L22'></a><a href='#L22'>22</a>
<a name='L23'></a><a href='#L23'>23</a>
<a name='L24'></a><a href='#L24'>24</a>
<a name='L25'></a><a href='#L25'>25</a>
<a name='L26'></a><a href='#L26'>26</a>
<a name='L27'></a><a href='#L27'>27</a>
<a name='L28'></a><a href='#L28'>28</a>
<a name='L29'></a><a href='#L29'>29</a>
<a name='L30'></a><a href='#L30'>30</a>
<a name='L31'></a><a href='#L31'>31</a>
<a name='L32'></a><a href='#L32'>32</a>
<a name='L33'></a><a href='#L33'>33</a>
<a name='L34'></a><a href='#L34'>34</a>
<a name='L35'></a><a href='#L35'>35</a>
<a name='L36'></a><a href='#L36'>36</a>
<a name='L37'></a><a href='#L37'>37</a>
<a name='L38'></a><a href='#L38'>38</a>
<a name='L39'></a><a href='#L39'>39</a>
<a name='L40'></a><a href='#L40'>40</a>
<a name='L41'></a><a href='#L41'>41</a>
<a name='L42'></a><a href='#L42'>42</a>
<a name='L43'></a><a href='#L43'>43</a>
<a name='L44'></a><a href='#L44'>44</a>
<a name='L45'></a><a href='#L45'>45</a>
<a name='L46'></a><a href='#L46'>46</a>
<a name='L47'></a><a href='#L47'>47</a>
<a name='L48'></a><a href='#L48'>48</a>
<a name='L49'></a><a href='#L49'>49</a>
<a name='L50'></a><a href='#L50'>50</a>
<a name='L51'></a><a href='#L51'>51</a>
<a name='L52'></a><a href='#L52'>52</a>
<a name='L53'></a><a href='#L53'>53</a>
<a name='L54'></a><a href='#L54'>54</a>
<a name='L55'></a><a href='#L55'>55</a>
<a name='L56'></a><a href='#L56'>56</a>
<a name='L57'></a><a href='#L57'>57</a>
<a name='L58'></a><a href='#L58'>58</a>
<a name='L59'></a><a href='#L59'>59</a>
<a name='L60'></a><a href='#L60'>60</a>
<a name='L61'></a><a href='#L61'>61</a>
<a name='L62'></a><a href='#L62'>62</a>
<a name='L63'></a><a href='#L63'>63</a>
<a name='L64'></a><a href='#L64'>64</a>
<a name='L65'></a><a href='#L65'>65</a>
<a name='L66'></a><a href='#L66'>66</a>
<a name='L67'></a><a href='#L67'>67</a>
<a name='L68'></a><a href='#L68'>68</a>
<a name='L69'></a><a href='#L69'>69</a>
<a name='L70'></a><a href='#L70'>70</a>
<a name='L71'></a><a href='#L71'>71</a>
<a name='L72'></a><a href='#L72'>72</a>
<a name='L73'></a><a href='#L73'>73</a>
<a name='L74'></a><a href='#L74'>74</a>
<a name='L75'></a><a href='#L75'>75</a>
<a name='L76'></a><a href='#L76'>76</a>
<a name='L77'></a><a href='#L77'>77</a>
<a name='L78'></a><a href='#L78'>78</a>
<a name='L79'></a><a href='#L79'>79</a>
<a name='L80'></a><a href='#L80'>80</a>
<a name='L81'></a><a href='#L81'>81</a>
<a name='L82'></a><a href='#L82'>82</a>
<a name='L83'></a><a href='#L83'>83</a>
<a name='L84'></a><a href='#L84'>84</a>
<a name='L85'></a><a href='#L85'>85</a>
<a name='L86'></a><a href='#L86'>86</a>
<a name='L87'></a><a href='#L87'>87</a>
<a name='L88'></a><a href='#L88'>88</a>
<a name='L89'></a><a href='#L89'>89</a>
<a name='L90'></a><a href='#L90'>90</a>
<a name='L91'></a><a href='#L91'>91</a>
<a name='L92'></a><a href='#L92'>92</a>
<a name='L93'></a><a href='#L93'>93</a>
<a name='L94'></a><a href='#L94'>94</a>
<a name='L95'></a><a href='#L95'>95</a>
<a name='L96'></a><a href='#L96'>96</a>
<a name='L97'></a><a href='#L97'>97</a>
<a name='L98'></a><a href='#L98'>98</a>
<a name='L99'></a><a href='#L99'>99</a>
<a name='L100'></a><a href='#L100'>100</a>
<a name='L101'></a><a href='#L101'>101</a>
<a name='L102'></a><a href='#L102'>102</a>
<a name='L103'></a><a href='#L103'>103</a>
<a name='L104'></a><a href='#L104'>104</a>
<a name='L105'></a><a href='#L105'>105</a>
<a name='L106'></a><a href='#L106'>106</a>
<a name='L107'></a><a href='#L107'>107</a>
<a name='L108'></a><a href='#L108'>108</a>
<a name='L109'></a><a href='#L109'>109</a>
<a name='L110'></a><a href='#L110'>110</a>
<a name='L111'></a><a href='#L111'>111</a>
<a name='L112'></a><a href='#L112'>112</a>
<a name='L113'></a><a href='#L113'>113</a>
<a name='L114'></a><a href='#L114'>114</a>
<a name='L115'></a><a href='#L115'>115</a>
<a name='L116'></a><a href='#L116'>116</a>
<a name='L117'></a><a href='#L117'>117</a>
<a name='L118'></a><a href='#L118'>118</a>
<a name='L119'></a><a href='#L119'>119</a>
<a name='L120'></a><a href='#L120'>120</a>
<a name='L121'></a><a href='#L121'>121</a>
<a name='L122'></a><a href='#L122'>122</a>
<a name='L123'></a><a href='#L123'>123</a>
<a name='L124'></a><a href='#L124'>124</a>
<a name='L125'></a><a href='#L125'>125</a>
<a name='L126'></a><a href='#L126'>126</a>
<a name='L127'></a><a href='#L127'>127</a>
<a name='L128'></a><a href='#L128'>128</a>
<a name='L129'></a><a href='#L129'>129</a>
<a name='L130'></a><a href='#L130'>130</a>
<a name='L131'></a><a href='#L131'>131</a>
<a name='L132'></a><a href='#L132'>132</a>
<a name='L133'></a><a href='#L133'>133</a>
<a name='L134'></a><a href='#L134'>134</a>
<a name='L135'></a><a href='#L135'>135</a>
<a name='L136'></a><a href='#L136'>136</a>
<a name='L137'></a><a href='#L137'>137</a>
<a name='L138'></a><a href='#L138'>138</a>
<a name='L139'></a><a href='#L139'>139</a>
<a name='L140'></a><a href='#L140'>140</a>
<a name='L141'></a><a href='#L141'>141</a>
<a name='L142'></a><a href='#L142'>142</a>
<a name='L143'></a><a href='#L143'>143</a>
<a name='L144'></a><a href='#L144'>144</a>
<a name='L145'></a><a href='#L145'>145</a>
<a name='L146'></a><a href='#L146'>146</a>
<a name='L147'></a><a href='#L147'>147</a>
<a name='L148'></a><a href='#L148'>148</a>
<a name='L149'></a><a href='#L149'>149</a>
<a name='L150'></a><a href='#L150'>150</a>
<a name='L151'></a><a href='#L151'>151</a>
<a name='L152'></a><a href='#L152'>152</a>
<a name='L153'></a><a href='#L153'>153</a>
<a name='L154'></a><a href='#L154'>154</a>
<a name='L155'></a><a href='#L155'>155</a>
<a name='L156'></a><a href='#L156'>156</a>
<a name='L157'></a><a href='#L157'>157</a>
<a name='L158'></a><a href='#L158'>158</a>
<a name='L159'></a><a href='#L159'>159</a>
<a name='L160'></a><a href='#L160'>160</a>
<a name='L161'></a><a href='#L161'>161</a>
<a name='L162'></a><a href='#L162'>162</a>
<a name='L163'></a><a href='#L163'>163</a>
<a name='L164'></a><a href='#L164'>164</a>
<a name='L165'></a><a href='#L165'>165</a>
<a name='L166'></a><a href='#L166'>166</a>
<a name='L167'></a><a href='#L167'>167</a>
<a name='L168'></a><a href='#L168'>168</a>
<a name='L169'></a><a href='#L169'>169</a>
<a name='L170'></a><a href='#L170'>170</a>
<a name='L171'></a><a href='#L171'>171</a>
<a name='L172'></a><a href='#L172'>172</a>
<a name='L173'></a><a href='#L173'>173</a>
<a name='L174'></a><a href='#L174'>174</a>
<a name='L175'></a><a href='#L175'>175</a>
<a name='L176'></a><a href='#L176'>176</a>
<a name='L177'></a><a href='#L177'>177</a>
<a name='L178'></a><a href='#L178'>178</a>
<a name='L179'></a><a href='#L179'>179</a>
<a name='L180'></a><a href='#L180'>180</a>
<a name='L181'></a><a href='#L181'>181</a>
<a name='L182'></a><a href='#L182'>182</a>
<a name='L183'></a><a href='#L183'>183</a>
<a name='L184'></a><a href='#L184'>184</a>
<a name='L185'></a><a href='#L185'>185</a>
<a name='L186'></a><a href='#L186'>186</a>
<a name='L187'></a><a href='#L187'>187</a>
<a name='L188'></a><a href='#L188'>188</a>
<a name='L189'></a><a href='#L189'>189</a>
<a name='L190'></a><a href='#L190'>190</a>
<a name='L191'></a><a href='#L191'>191</a>
<a name='L192'></a><a href='#L192'>192</a>
<a name='L193'></a><a href='#L193'>193</a>
<a name='L194'></a><a href='#L194'>194</a>
<a name='L195'></a><a href='#L195'>195</a>
<a name='L196'></a><a href='#L196'>196</a>
<a name='L197'></a><a href='#L197'>197</a>
<a name='L198'></a><a href='#L198'>198</a>
<a name='L199'></a><a href='#L199'>199</a>
<a name='L200'></a><a href='#L200'>200</a>
<a name='L201'></a><a href='#L201'>201</a>
<a name='L202'></a><a href='#L202'>202</a>
<a name='L203'></a><a href='#L203'>203</a>
<a name='L204'></a><a href='#L204'>204</a>
<a name='L205'></a><a href='#L205'>205</a>
<a name='L206'></a><a href='#L206'>206</a>
<a name='L207'></a><a href='#L207'>207</a>
<a name='L208'></a><a href='#L208'>208</a>
<a name='L209'></a><a href='#L209'>209</a>
<a name='L210'></a><a href='#L210'>210</a>
<a name='L211'></a><a href='#L211'>211</a>
<a name='L212'></a><a href='#L212'>212</a>
<a name='L213'></a><a href='#L213'>213</a>
<a name='L214'></a><a href='#L214'>214</a>
<a name='L215'></a><a href='#L215'>215</a>
<a name='L216'></a><a href='#L216'>216</a>
<a name='L217'></a><a href='#L217'>217</a>
<a name='L218'></a><a href='#L218'>218</a>
<a name='L219'></a><a href='#L219'>219</a>
<a name='L220'></a><a href='#L220'>220</a>
<a name='L221'></a><a href='#L221'>221</a>
<a name='L222'></a><a href='#L222'>222</a>
<a name='L223'></a><a href='#L223'>223</a>
<a name='L224'></a><a href='#L224'>224</a>
<a name='L225'></a><a href='#L225'>225</a>
<a name='L226'></a><a href='#L226'>226</a>
<a name='L227'></a><a href='#L227'>227</a>
<a name='L228'></a><a href='#L228'>228</a>
<a name='L229'></a><a href='#L229'>229</a>
<a name='L230'></a><a href='#L230'>230</a>
<a name='L231'></a><a href='#L231'>231</a>
<a name='L232'></a><a href='#L232'>232</a>
<a name='L233'></a><a href='#L233'>233</a>
<a name='L234'></a><a href='#L234'>234</a>
<a name='L235'></a><a href='#L235'>235</a></td><td class="line-coverage quiet"><span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span></td><td class="text"><pre class="prettyprint lang-js"><span class="cstat-no" title="statement not covered" >import { GoogleGenAI, GenerateContentResponse, GroundingChunk } from "@google/genai";<span class="fstat-no" title="function not covered" ><span class="branch-0 cbranch-no" title="branch not covered" ></span></span></span>
<span class="cstat-no" title="statement not covered" >import { GEMINI_MODEL_NAME } from '../constants';</span>
import { ScannedFoodInfo, SevenDayPlanResponse } from "../types";
<span class="cstat-no" title="statement not covered" >import { log } from '../src/services/loggingService';</span>
&nbsp;
<span class="cstat-no" title="statement not covered" >const API_KEY = import.meta.env.VITE_API_KEY;</span>
<span class="cstat-no" title="statement not covered" >export const API_KEY_ERROR_MESSAGE = "API Key not configured or invalid. AI-powered features are unavailable. Please ensure the API_KEY environment variable is set correctly by the application administrator.";</span>
<span class="cstat-no" title="statement not covered" >const MISSING_KEY_PLACEHOLDER_FOR_CONSTRUCTOR = "MISSING_API_KEY_RUNTIME_CONSTRUCTOR_DietWise";</span>
&nbsp;
<span class="cstat-no" title="statement not covered" >if (!API_KEY || API_KEY === "MISSING_API_KEY" || API_KEY.length &lt; 10 || API_KEY === MISSING_KEY_PLACEHOLDER_FOR_CONSTRUCTOR) {</span>
<span class="cstat-no" title="statement not covered" >  const message = `CRITICAL DietWise SETUP ERROR: The Gemini API Key is not configured or is the placeholder value. AI features will not function. Please ensure the 'API_KEY' environment variable is correctly set in the deployment environment. Current key starts with: ${API_KEY ? API_KEY.substring(0,5) : 'undefined'}`;</span>
<span class="cstat-no" title="statement not covered" >  log.error(message, 'gemini-service', { apiKeyProvided: !!API_KEY, apiKeyLength: API_KEY?.length || 0 });</span>
  // No throw here to allow app to load and show errors in UI
<span class="cstat-no" title="statement not covered" >}</span>
&nbsp;
// Use a placeholder if API_KEY is truly missing at runtime for the constructor,
// but individual function calls will check and prevent actual API calls.
<span class="cstat-no" title="statement not covered" >const ai = new GoogleGenAI({ apiKey: API_KEY || MISSING_KEY_PLACEHOLDER_FOR_CONSTRUCTOR });</span>
&nbsp;
<span class="cstat-no" title="statement not covered" >const isApiKeyInvalid = () =&gt; !API_KEY || API_KEY === "MISSING_API_KEY" || API_KEY.length &lt; 10 || API_KEY === MISSING_KEY_PLACEHOLDER_FOR_CONSTRUCTOR;</span>
&nbsp;
<span class="cstat-no" title="statement not covered" >export const getMealIdeas = async (calorieTarget: number, preferences?: string): Promise&lt;{ ideas: string | null; error?: string }&gt; =&gt; {</span>
<span class="cstat-no" title="statement not covered" >  log.time('getMealIdeas', 'gemini-service');</span>
<span class="cstat-no" title="statement not covered" >  log.info('Requesting meal ideas via backend API', 'gemini-service', { calorieTarget, hasPreferences: !!preferences });</span>
  
<span class="cstat-no" title="statement not covered" >  try {</span>
<span class="cstat-no" title="statement not covered" >    const API_BASE_URL = process.env.VITE_API_BASE_URL || 'http://localhost:3001';</span>
    
<span class="cstat-no" title="statement not covered" >    const requestBody = {</span>
<span class="cstat-no" title="statement not covered" >      calorieTarget,</span>
<span class="cstat-no" title="statement not covered" >      mealType: 'dinner', // Default meal type</span>
<span class="cstat-no" title="statement not covered" >      preferences: preferences ? [preferences] : []</span>
<span class="cstat-no" title="statement not covered" >    };</span>
&nbsp;
<span class="cstat-no" title="statement not covered" >    const response = await fetch(`${API_BASE_URL}/api/v1/ai/meal-ideas`, {</span>
<span class="cstat-no" title="statement not covered" >      method: 'POST',</span>
<span class="cstat-no" title="statement not covered" >      headers: {</span>
<span class="cstat-no" title="statement not covered" >        'Content-Type': 'application/json',</span>
<span class="cstat-no" title="statement not covered" >        'Authorization': `Bearer ${localStorage.getItem('auth_token') || ''}`</span>
<span class="cstat-no" title="statement not covered" >      },</span>
<span class="cstat-no" title="statement not covered" >      body: JSON.stringify(requestBody)</span>
<span class="cstat-no" title="statement not covered" >    });</span>
&nbsp;
<span class="cstat-no" title="statement not covered" >    if (!response.ok) {</span>
<span class="cstat-no" title="statement not covered" >      const errorData = await response.json().catch(() =&gt; ({}));</span>
<span class="cstat-no" title="statement not covered" >      throw new Error(errorData.message || `HTTP ${response.status}: ${response.statusText}`);</span>
<span class="cstat-no" title="statement not covered" >    }</span>
&nbsp;
<span class="cstat-no" title="statement not covered" >    const data = await response.json();</span>
    
<span class="cstat-no" title="statement not covered" >    log.timeEnd('getMealIdeas', 'gemini-service');</span>
<span class="cstat-no" title="statement not covered" >    log.info('Meal ideas request successful', 'gemini-service', { </span>
<span class="cstat-no" title="statement not covered" >      responseLength: data.data?.length || 0,</span>
<span class="cstat-no" title="statement not covered" >      calorieTarget </span>
<span class="cstat-no" title="statement not covered" >    });</span>
    
<span class="cstat-no" title="statement not covered" >    return { ideas: data.data ?? null, error: undefined };</span>
<span class="cstat-no" title="statement not covered" >  } catch (error: any) {</span>
<span class="cstat-no" title="statement not covered" >    log.timeEnd('getMealIdeas', 'gemini-service');</span>
<span class="cstat-no" title="statement not covered" >    log.error('Error fetching meal ideas from backend', 'gemini-service', { </span>
<span class="cstat-no" title="statement not covered" >      error: error.message,</span>
<span class="cstat-no" title="statement not covered" >      calorieTarget,</span>
<span class="cstat-no" title="statement not covered" >      hasPreferences: !!preferences</span>
<span class="cstat-no" title="statement not covered" >    });</span>
<span class="cstat-no" title="statement not covered" >    return { ideas: null, error: error.message || "Sorry, we couldn't fetch meal ideas at this time. Please try again later." };</span>
<span class="cstat-no" title="statement not covered" >  }</span>
<span class="cstat-no" title="statement not covered" >};</span>
&nbsp;
<span class="cstat-no" title="statement not covered" >export const getFoodInfoFromUPC = async (upc: string): Promise&lt;{ foodInfo: ScannedFoodInfo | null; error?: string; sources?: GroundingChunk[] }&gt; =&gt; {</span>
<span class="cstat-no" title="statement not covered" >  if (isApiKeyInvalid()) {</span>
<span class="cstat-no" title="statement not covered" >    return { foodInfo: null, error: API_KEY_ERROR_MESSAGE };</span>
<span class="cstat-no" title="statement not covered" >  }</span>
<span class="cstat-no" title="statement not covered" >  try {</span>
<span class="cstat-no" title="statement not covered" >    const prompt = `Search the web for nutritional information for a product with UPC ${upc}. </span>
Provide its name, brand (if available), serving size (e.g., '100g' or '1 item'), calories per serving, protein (g) per serving, carbohydrates (g) per serving, and fat (g) per serving.
Present this information clearly.
If you cannot find specific nutritional details, state what you found and what is missing.
If the product itself cannot be identified from the UPC, respond with ONLY the text 'Product not found for this UPC'.
Otherwise, try to format your findings as a JSON-like structure within your text response, for example:
{
  "name": "Product Name",
  "brand": "Brand Name",
  "servingSize": "100g",
  "calories": 200,
  "protein": 10,
  "carbs": 30,
  "fat": 5
}
If some nutritional values are missing, omit them from the JSON structure or set them to null. Also include any textual description you found.`;
&nbsp;
<span class="cstat-no" title="statement not covered" >    const response: GenerateContentResponse = await ai.models.generateContent({</span>
<span class="cstat-no" title="statement not covered" >      model: GEMINI_MODEL_NAME,</span>
<span class="cstat-no" title="statement not covered" >      contents: prompt,</span>
<span class="cstat-no" title="statement not covered" >      config: {</span>
<span class="cstat-no" title="statement not covered" >        tools: [{googleSearch: {}}],</span>
<span class="cstat-no" title="statement not covered" >      }</span>
<span class="cstat-no" title="statement not covered" >    });</span>
&nbsp;
<span class="cstat-no" title="statement not covered" >    const textResponse = response.text;</span>
<span class="cstat-no" title="statement not covered" >    const groundingMetadata = response.candidates?.[0]?.groundingMetadata;</span>
<span class="cstat-no" title="statement not covered" >    const sources = groundingMetadata?.groundingChunks || [];</span>
&nbsp;
<span class="cstat-no" title="statement not covered" >    if (!textResponse) {</span>
<span class="cstat-no" title="statement not covered" >      return { foodInfo: null, error: "No response from AI service.", sources };</span>
<span class="cstat-no" title="statement not covered" >    }</span>
&nbsp;
<span class="cstat-no" title="statement not covered" >    if (textResponse.includes("Product not found for this UPC")) {</span>
<span class="cstat-no" title="statement not covered" >      return { foodInfo: null, error: "Product information not found for this UPC.", sources };</span>
<span class="cstat-no" title="statement not covered" >    }</span>
&nbsp;
<span class="cstat-no" title="statement not covered" >    const jsonRegex = /{\s*[\s\S]*?\s*}/m; </span>
<span class="cstat-no" title="statement not covered" >    const match = textResponse.match(jsonRegex);</span>
&nbsp;
<span class="cstat-no" title="statement not covered" >    if (match &amp;&amp; match[0]) {</span>
<span class="cstat-no" title="statement not covered" >      try {</span>
<span class="cstat-no" title="statement not covered" >        let jsonStr = match[0];</span>
        // Attempt to fix common JSON issues like trailing commas before closing braces/brackets
<span class="cstat-no" title="statement not covered" >        jsonStr = jsonStr.replace(/,\s*([}\]])/g, '$1'); </span>
&nbsp;
<span class="cstat-no" title="statement not covered" >        const parsedData = JSON.parse(jsonStr) as ScannedFoodInfo;</span>
        // Check for at least a name and one nutritional value to consider it valid
<span class="cstat-no" title="statement not covered" >        if (parsedData.name &amp;&amp; (parsedData.calories !== undefined || parsedData.protein !== undefined || parsedData.carbs !== undefined || parsedData.fat !== undefined)) {</span>
<span class="cstat-no" title="statement not covered" >           return { foodInfo: parsedData, sources };</span>
<span class="cstat-no" title="statement not covered" >        }</span>
<span class="cstat-no" title="statement not covered" >      } catch (e) {</span>
&nbsp;
        // Return a more generic "parsing issue" foodInfo object to indicate an attempt was made
<span class="cstat-no" title="statement not covered" >        return { foodInfo: { name: "Product (parsing issue)", calories: undefined }, error: `Could not fully parse nutritional data. Details: ${textResponse.substring(0,150)}...`, sources };</span>
<span class="cstat-no" title="statement not covered" >      }</span>
<span class="cstat-no" title="statement not covered" >    }</span>
&nbsp;
    // If no JSON match or parsed JSON is invalid
<span class="cstat-no" title="statement not covered" >    return { foodInfo: { name: "Product (data extraction issue)", calories: undefined }, error: `Could not extract structured data. Details: ${textResponse.substring(0,150)}...`, sources };</span>
&nbsp;
<span class="cstat-no" title="statement not covered" >  } catch (error: any) {</span>
<span class="cstat-no" title="statement not covered" >    if (process.env.NODE_ENV !== 'production') {</span>
<span class="cstat-no" title="statement not covered" >    console.error("Error fetching food info from UPC via Gemini:", error);</span>
<span class="cstat-no" title="statement not covered" >    }</span>
<span class="cstat-no" title="statement not covered" >    const errorMessage = error.message || "Could not fetch food information for this UPC. Please try again.";</span>
<span class="cstat-no" title="statement not covered" >    return { foodInfo: null, error: errorMessage };</span>
<span class="cstat-no" title="statement not covered" >  }</span>
<span class="cstat-no" title="statement not covered" >};</span>
&nbsp;
<span class="cstat-no" title="statement not covered" >export const getSevenDayDietPlan = async (</span>
<span class="cstat-no" title="statement not covered" >  calorieTarget: number, </span>
<span class="cstat-no" title="statement not covered" >  preferences?: string</span>
<span class="cstat-no" title="statement not covered" >): Promise&lt;{ planData: SevenDayPlanResponse | null; error?: string; sources?: GroundingChunk[] }&gt; =&gt; {</span>
<span class="cstat-no" title="statement not covered" >  if (isApiKeyInvalid()) {</span>
<span class="cstat-no" title="statement not covered" >    return { planData: null, error: API_KEY_ERROR_MESSAGE };</span>
<span class="cstat-no" title="statement not covered" >  }</span>
&nbsp;
<span class="cstat-no" title="statement not covered" >  const prompt = `</span>
<span class="cstat-no" title="statement not covered" >Create a detailed 7-day meal plan targeting approximately ${calorieTarget} calories per day.</span>
<span class="cstat-no" title="statement not covered" >${preferences ? `Incorporate these dietary preferences: ${preferences}.` : ''}</span>
For each day, provide meals for breakfast, lunch, dinner, and 1-2 healthy snacks. 
Include a name and a brief description for each meal item. Estimate calories for each meal if possible.
&nbsp;
Additionally, generate a comprehensive shopping list for the entire 7-day plan. 
Categorize the shopping list (e.g., Produce, Protein, Dairy, Pantry Staples). 
For each item, suggest a quantity (e.g., "1kg", "2 cans", "1 loaf") and, if possible, mention common brand examples or types (e.g., "Quaker Oats", "Tyson Chicken Breast", "Barilla Whole Wheat Pasta", "Fage Total 0% Greek Yogurt"). If a specific brand isn't applicable, suggest a generic type like "Low-sodium soy sauce".
&nbsp;
Return the entire response as a single JSON object with the following structure:
{
  "dailyPlans": [
    {
      "day": 1, 
      "meals": {
        "breakfast": { "name": "Meal Name", "description": "Details...", "calories": 300 },
        "lunch": { "name": "Meal Name", "description": "Details...", "calories": 500 },
        "dinner": { "name": "Meal Name", "description": "Details...", "calories": 700 },
        "snacks": [
          { "name": "Snack Name", "description": "Details...", "calories": 250 }
        ]
      },
      "dailyCalories": 1750 
    } 
  ],
  "shoppingList": [
    {
      "category": "Category Name", 
      "items": [
        { "name": "Item Name", "quantity": "Amount", "brandSuggestion": "Brand or Type", "notes": "Optional extra info" }
      ]
    }
  ]
}
Ensure the JSON is valid.
`;
&nbsp;
<span class="cstat-no" title="statement not covered" >  try {</span>
<span class="cstat-no" title="statement not covered" >    const response: GenerateContentResponse = await ai.models.generateContent({</span>
<span class="cstat-no" title="statement not covered" >      model: GEMINI_MODEL_NAME,</span>
<span class="cstat-no" title="statement not covered" >      contents: prompt,</span>
<span class="cstat-no" title="statement not covered" >      config: {</span>
<span class="cstat-no" title="statement not covered" >        tools: [{ googleSearch: {} }], </span>
<span class="cstat-no" title="statement not covered" >        responseMimeType: "application/json",</span>
<span class="cstat-no" title="statement not covered" >      }</span>
<span class="cstat-no" title="statement not covered" >    });</span>
&nbsp;
<span class="cstat-no" title="statement not covered" >    const groundingMetadata = response.candidates?.[0]?.groundingMetadata;</span>
<span class="cstat-no" title="statement not covered" >    const sources = groundingMetadata?.groundingChunks || [];</span>
<span class="cstat-no" title="statement not covered" >    let jsonStr = response.text?.trim() || '';</span>
&nbsp;
    // Remove markdown fences if present
<span class="cstat-no" title="statement not covered" >    const fenceRegex = /^```(\w*)?\s*\n?(.*?)\n?\s*```$/s;</span>
<span class="cstat-no" title="statement not covered" >    const match = jsonStr.match(fenceRegex);</span>
<span class="cstat-no" title="statement not covered" >    if (match &amp;&amp; match[2]) {</span>
<span class="cstat-no" title="statement not covered" >      jsonStr = match[2].trim();</span>
<span class="cstat-no" title="statement not covered" >    }</span>
&nbsp;
<span class="cstat-no" title="statement not covered" >    try {</span>
<span class="cstat-no" title="statement not covered" >      const parsedData = JSON.parse(jsonStr) as SevenDayPlanResponse;</span>
<span class="cstat-no" title="statement not covered" >      if (parsedData &amp;&amp; parsedData.dailyPlans &amp;&amp; parsedData.dailyPlans.length &gt; 0 &amp;&amp; parsedData.shoppingList) {</span>
<span class="cstat-no" title="statement not covered" >        return { planData: parsedData, sources };</span>
<span class="cstat-no" title="statement not covered" >      } else {</span>
&nbsp;
<span class="cstat-no" title="statement not covered" >        return { planData: null, error: "Received plan data in an unexpected format. Please try again. Raw: " + (response.text?.substring(0,100) || 'No response'), sources };</span>
<span class="cstat-no" title="statement not covered" >      }</span>
<span class="cstat-no" title="statement not covered" >    } catch (e: any) {</span>
<span class="cstat-no" title="statement not covered" >      if (process.env.NODE_ENV !== 'production') {</span>
<span class="cstat-no" title="statement not covered" >      console.error("Failed to parse JSON response for meal plan:", e);</span>
<span class="cstat-no" title="statement not covered" >      }</span>
       // Log the problematic text
<span class="cstat-no" title="statement not covered" >      return { planData: null, error: `Failed to parse meal plan data. Please try again. Error: ${e.message}. Raw: ${response.text?.substring(0,100) || 'No response'}...`, sources };</span>
<span class="cstat-no" title="statement not covered" >    }</span>
&nbsp;
<span class="cstat-no" title="statement not covered" >  } catch (error: any) {</span>
<span class="cstat-no" title="statement not covered" >    if (process.env.NODE_ENV !== 'production') {</span>
<span class="cstat-no" title="statement not covered" >    console.error("Error fetching 7-day diet plan from Gemini:", error);</span>
<span class="cstat-no" title="statement not covered" >    }</span>
<span class="cstat-no" title="statement not covered" >    const errorMessage = error.message || "Could not generate the 7-day meal plan. Please try again later.";</span>
<span class="cstat-no" title="statement not covered" >    return { planData: null, error: errorMessage };</span>
<span class="cstat-no" title="statement not covered" >  }</span>
<span class="cstat-no" title="statement not covered" >};</span>
&nbsp;</pre></td></tr></table></pre>

                <div class='push'></div><!-- for sticky footer -->
            </div><!-- /wrapper -->
            <div class='footer quiet pad2 space-top1 center small'>
                Code coverage generated by
                <a href="https://istanbul.js.org/" target="_blank" rel="noopener noreferrer">istanbul</a>
                at 2025-06-25T15:38:36.941Z
            </div>
        <script src="../../prettify.js"></script>
        <script>
            window.onload = function () {
                prettyPrint();
            };
        </script>
        <script src="../../sorter.js"></script>
        <script src="../../block-navigation.js"></script>
    </body>
</html>
    